<!doctype html><html><title>ðŸ’€</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:image" content="https://platane.github.io/skull-ocean/images/800x800.jpg"><meta name="description" content="A grim wave simulation. It was made for the 2022 js13kGames.com competition."><meta name="title" content="Skull Ocean"><meta name="viewport" content="width=device-width,initial-scale=1"><style>html{font-family:monospace,sans-serif;background-color:#ede5d2;color:#42372b}canvas{position:fixed;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(#ede5d2,#d7c69f);touch-action:none}footer{position:fixed;bottom:0;right:0;padding:0 4px;font-size:16px}div{position:fixed;top:10px;left:10px}h1{margin-top:0}</style><body><canvas></canvas><div><h1>Skull Ocean</h1><span>Tap to create waves<br>Slide to rotate</span></div><footer><a href="https://github.com/platane/skull-ocean">source</a></footer></body><script>let a=document.getElementsByTagName("canvas")[0],t=a.getContext("webgl2"),r=Math.min(window.devicePixelRatio??1,2),n=()=>{const n=window.innerWidth*r,o=window.innerHeight*r;a.width=n,a.height=o,t.viewport(0,0,n,o)};n(),window.addEventListener("resize",n);var o,e="undefined"!=typeof Float32Array?Float32Array:Array;function i(){var a=new e(9);return e!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function l(a,t){a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[4],a[4]=t[5],a[5]=t[6],a[6]=t[8],a[7]=t[9],a[8]=t[10]}function h(a,t){var r=t[0],n=t[1],o=t[2],e=t[3],i=t[4],l=t[5],h=t[6],M=t[7],v=t[8],u=t[9],c=t[10],f=t[11],s=t[12],w=t[13],m=t[14],y=r*l-n*i,p=r*h-o*i,g=r*M-e*i,A=n*h-o*l,_=n*M-e*l,d=o*M-e*h,F=v*w-u*s,x=v*m-c*s,X=u*m-c*w;(f=y*(c=c*(t=t[15])-f*m)-p*(u=u*t-f*w)+g*X+A*(v=v*t-f*s)-_*x+d*F)&&(a[0]=(l*c-h*u+M*X)*(f=1/f),a[1]=(h*v-i*c-M*x)*f,a[2]=(i*u-l*v+M*F)*f,a[3]=(o*u-n*c-e*X)*f,a[4]=(r*c-o*v+e*x)*f,a[5]=(n*v-r*u-e*F)*f,a[6]=(w*d-m*_+t*A)*f,a[7]=(m*g-s*d-t*p)*f,a[8]=(s*_-w*g+t*y)*f)}function M(){var a=new e(16);return e!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function v(a){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1}function u(a,t,r){var n=t[0],o=t[1],e=t[2],i=t[3],l=t[4],h=t[5],M=t[6],v=t[7],u=t[8],c=t[9],f=t[10],s=t[11],w=t[12],m=t[13],y=t[14];t=t[15];var p=r[0],g=r[1],A=r[2],_=r[3];a[0]=p*n+g*l+A*u+_*w,a[1]=p*o+g*h+A*c+_*m,a[2]=p*e+g*M+A*f+_*y,a[3]=p*i+g*v+A*s+_*t,a[4]=(p=r[4])*n+(g=r[5])*l+(A=r[6])*u+(_=r[7])*w,a[5]=p*o+g*h+A*c+_*m,a[6]=p*e+g*M+A*f+_*y,a[7]=p*i+g*v+A*s+_*t,a[8]=(p=r[8])*n+(g=r[9])*l+(A=r[10])*u+(_=r[11])*w,a[9]=p*o+g*h+A*c+_*m,a[10]=p*e+g*M+A*f+_*y,a[11]=p*i+g*v+A*s+_*t,a[12]=(p=r[12])*n+(g=r[13])*l+(A=r[14])*u+(_=r[15])*w,a[13]=p*o+g*h+A*c+_*m,a[14]=p*e+g*M+A*f+_*y,a[15]=p*i+g*v+A*s+_*t}function c(a,t,r){var n=t[0],o=t[1],e=t[2],i=t[3],l=n+n,h=o+o,M=e+e;t=n*l;var v=n*h;n*=M;var u=o*h;o*=M,l*=i,h*=i,i*=M,a[0]=1-(u+(e*=M)),a[1]=v+i,a[2]=n-h,a[3]=0,a[4]=v-i,a[5]=1-(t+e),a[6]=o+l,a[7]=0,a[8]=n+h,a[9]=o-l,a[10]=1-(t+u),a[11]=0,a[12]=r[0],a[13]=r[1],a[14]=r[2],a[15]=1}function f(){var a=L,t=1/Math.tan(S/2);a[0]=t/z,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,a[10]=2000.005*(t=1/-1999.995),a[14]=20*t}function s(){var a=new e(3);return e!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function w(a,t){var r=new e(3);return r[0]=a,r[1]=t,r[2]=0,r}function m(a,t,r,n){return a[0]=t,a[1]=r,a[2]=n,a}function y(a,t,r){a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2]}function p(a,t,r,n){a[0]=t[0]+r[0]*n,a[1]=t[1]+r[1]*n,a[2]=t[2]+r[2]*n}function g(a,t){var r=t[0],n=t[1],o=t[2];0<(r=r*r+n*n+o*o)&&(r=1/Math.sqrt(r)),a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r}function A(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]}function _(a,t,r){var n=t[0],o=t[1],e=r[0],i=r[1];a[0]=o*(r=r[2])-(t=t[2])*i,a[1]=t*e-n*r,a[2]=n*i-o*e}function d(a,t,r){var n=t[0],o=t[1],e=r[3]*n+r[7]*o+r[11]*(t=t[2])+r[15];a[0]=(r[0]*n+r[4]*o+r[8]*t+r[12])/(e=e||1),a[1]=(r[1]*n+r[5]*o+r[9]*t+r[13])/e,a[2]=(r[2]*n+r[6]*o+r[10]*t+r[14])/e}function F(){var a=new e(4);return e!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function x(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function X(a,t,r){r*=.5;var n=t[0],o=t[1],e=t[2];t=t[3];var i=Math.sin(r);r=Math.cos(r),a[0]=n*r+t*i,a[1]=o*r+e*i,a[2]=e*r-o*i,a[3]=t*r-n*i}function Y(a,t,r){r*=.5;var n=t[0],o=t[1],e=t[2];t=t[3];var i=Math.sin(r);r=Math.cos(r),a[0]=n*r-e*i,a[1]=o*r+t*i,a[2]=e*r+n*i,a[3]=t*r-o*i}function C(a,t,r,n){var o=t[0],e=t[1],i=t[2],l=r[0],h=r[1],M=r[2],v=o*l+e*h+i*M+(t=t[3])*(r=r[3]);if(0>v&&(v=-v,l=-l,h=-h,M=-M,r=-r),1e-6<1-v){var u=Math.acos(v),c=Math.sin(u);v=Math.sin((1-n)*u)/c,n=Math.sin(n*u)/c}else v=1-n;a[0]=v*o+n*l,a[1]=v*e+n*h,a[2]=v*i+n*M,a[3]=v*t+n*r}function D(a){var t=360*Math.random(),r=360*Math.random(),n=360*Math.random(),o=.5*Math.PI/180;t*=o,r*=o,n*=o,o=Math.sin(t),t=Math.cos(t);var e=Math.sin(r);r=Math.cos(r);var i=Math.sin(n);n=Math.cos(n),a[0]=o*r*n-t*e*i,a[1]=t*e*n+o*r*i,a[2]=t*r*i-o*e*n,a[3]=t*r*n+o*e*i}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)}),s(),o=new e(4),e!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0);var P=(()=>{var a=s(),t=w(1,0),r=w(0,1);return(n,o,e)=>{var i=A(o,e);return-.999999>i?(_(a,t,o),1e-6>Math.hypot(a[0],a[1],a[2])&&_(a,r,o),g(a,a),o=Math.PI,o*=.5,e=Math.sin(o),n[0]=e*a[0],n[1]=e*a[1],n[2]=e*a[2],n[3]=Math.cos(o),n):.999999<i?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(_(a,o,e),n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=1+i,((a,t)=>{var r=t[0],n=t[1],o=t[2],e=r*r+n*n+o*o+(t=t[3])*t;return 0<e&&(e=1/Math.sqrt(e)),a[0]=r*e,a[1]=n*e,a[2]=o*e,a[3]=t*e,a})(n,n))}})();function b(){var a=new e(2);return e!=Float32Array&&(a[0]=0,a[1]=0),a}F(),F(),i(),b();let j=new Float32Array(36),I=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,I),t.bufferData(t.ARRAY_BUFFER,j,t.DYNAMIC_DRAW);let L=new Float32Array(16),S=Math.PI/3,z=window.innerWidth/window.innerHeight;f();let k=1.2,q=1,U=5,B=[0,0,0],E=[0,0,1],G=[0,1,0],H=M(),J=i(),K=M(),N=i(),O=M(),Q=()=>{var a=12+U*U*.18,r=Math.sin(k)*a;E[0]=r*Math.sin(q),E[1]=Math.cos(k)*a,E[2]=r*Math.cos(q),a=E[0],r=E[1];var n=E[2],o=G[0],e=G[1],i=G[2],M=B[0],c=B[1],f=B[2];if(1e-6>Math.abs(a-M)&&1e-6>Math.abs(r-c)&&1e-6>Math.abs(n-f))v(H);else{M=a-M,c=r-c;var s=n-f,w=1/Math.hypot(M,c,s);f=e*(s*=w)-i*(c*=w),i=i*(M*=w)-o*s,o=o*c-e*M,(w=Math.hypot(f,i,o))?(f*=w=1/w,i*=w,o*=w):o=i=f=0,e=c*o-s*i;var m=s*f-M*o,y=M*i-c*f;(w=Math.hypot(e,m,y))?(e*=w=1/w,m*=w,y*=w):y=m=e=0,H[0]=f,H[1]=e,H[2]=M,H[3]=0,H[4]=i,H[5]=m,H[6]=c,H[7]=0,H[8]=o,H[9]=y,H[10]=s,H[11]=0,H[12]=-(f*a+i*r+o*n),H[13]=-(e*a+m*r+y*n),H[14]=-(M*a+c*r+s*n),H[15]=1}for(u(K,L,H),l(J,H),h(N,H),O[0]=N[0],O[1]=N[1],O[2]=N[2],O[3]=0,O[4]=N[3],O[5]=N[4],O[6]=N[5],O[7]=0,O[8]=N[6],O[9]=N[7],O[10]=N[8],O[11]=0,O[12]=0,O[13]=0,O[14]=0,O[15]=1,r=Math.hypot(E[0],E[2]),a=9999,.81<E[1]&&(a=(17*1.4+r)/((E[1]-.8)/(E[1]- -4))-r),r=0;4>r;r++)n=2*Math.PI*r/4+Math.PI/4,M=2*Math.PI*(r+1)/4+Math.PI/4,j[9*r]=0,j[9*r+1]=-4,j[9*r+2]=0,j[9*r+3]=Math.sin(n)*a,j[9*r+4]=-4,j[9*r+5]=Math.cos(n)*a,j[9*r+6]=Math.sin(M)*a,j[9*r+7]=-4,j[9*r+8]=Math.cos(M)*a;t.bindBuffer(t.ARRAY_BUFFER,I),t.bufferSubData(t.ARRAY_BUFFER,0,j)};Q();let R=0,T=null,V=null,W=null,Z=a=>{1===a.length?(T=null,(([{pageX:a,pageY:t}])=>{V=a,W=t})(a)):1<a.length&&(V=null,(([{pageX:a,pageY:t},{pageX:r,pageY:n}])=>{R=U,T=Math.sqrt((a-r)**2+(t-n)**2)})(a))};a.addEventListener("wheel",a=>{U=Math.min(Math.max(U+(0>a.deltaY?-1:1),0),10),Q()},{passive:1}),window.addEventListener("resize",()=>{z=window.innerWidth/window.innerHeight,f(),Q()},{passive:1});let $=[],aa=(a,t,r,n)=>{var o=K[0],e=K[1],i=K[2],l=K[3],h=K[4],M=K[5],v=K[6],u=K[7],c=K[8],f=K[9],s=K[10],w=K[11],m=K[12],p=K[13],A=K[14],_=K[15],F=o*M-e*h,x=o*v-i*h,X=o*u-l*h,Y=e*v-i*M,C=e*u-l*M,D=i*u-l*v,P=c*p-f*m,b=c*A-s*m,j=c*_-w*m,I=f*A-s*p,L=f*_-w*p,S=s*_-w*A,z=F*S-x*L+X*I+Y*j-C*b+D*P;z&&($[0]=(M*S-v*L+u*I)*(z=1/z),$[1]=(i*L-e*S-l*I)*z,$[2]=(p*D-A*C+_*Y)*z,$[3]=(s*C-f*D-w*Y)*z,$[4]=(v*j-h*S-u*b)*z,$[5]=(o*S-i*j+l*b)*z,$[6]=(A*X-m*D-_*x)*z,$[7]=(c*D-s*X+w*x)*z,$[8]=(h*L-M*j+u*P)*z,$[9]=(e*j-o*L-l*P)*z,$[10]=(m*C-p*X+_*F)*z,$[11]=(f*X-c*C-w*F)*z,$[12]=(M*b-h*I-v*P)*z,$[13]=(o*I-e*b+i*P)*z,$[14]=(p*x-m*Y-A*F)*z,$[15]=(c*Y-f*x+s*F)*z),d(t,[r,n,.5],$),y(t,t,E),g(t,t),a[0]=E[0],a[1]=E[1],a[2]=E[2]},ta=s(),ra=s(),na=(a,t)=>{var r=la;a[0]=r[3*t],a[1]=r[3*t+1],a[2]=r[3*t+2]},oa=(a,t,r)=>{a[0]=t[4*r],a[1]=t[4*r+1],a[2]=t[4*r+2],a[3]=t[4*r+3]},ea=(a,t)=>{var r=ut;a[3*t]=r[0],a[3*t+1]=r[1],a[3*t+2]=r[2]},ia=(a,t,r)=>{a[4*t]=r[0],a[4*t+1]=r[1],a[4*t+2]=r[2],a[4*t+3]=r[3]},la=new Float32Array(7500),ha=new Float32Array(1e4),Ma=s(),va=s(),ua=s(),ca=0,fa=0,sa=0,wa=s(),ma=s(),ya=s(),pa=F();x(pa),ya[1]=2;let ga=s();ga[2]=1;let Aa=[],_a=b(),da=s(),Fa=17*1.6,xa=Array.from({length:2}).map((a,t,{length:r})=>{a=t/r,(t=b())[1]=1;var n=(Math.random()-.5)*Math.PI*.1;r=t[0]-_a[0];var o=t[1]-_a[1],e=Math.sin(n);return n=Math.cos(n),t[0]=r*n-o*e+_a[0],t[1]=r*e+o*n+_a[1],r=s(),o=Math.random(),{n:t,t:25.5,o:a*Fa*2-Fa,i:3,l:0,h:4,force:m(r,0,-(.5*(1-o)+.6*o),0)}});Aa.push(...xa);let Xa={n:b(),t:0,o:1,l:1,i:1,h:0,force:m(s(),0,0,0),s:0,M:Infinity};Aa.push(Xa);let Ya,Ca=s(),Da=s(),Pa=b(),ba=0,ja=null,Ia=a=>{a[0]&&(ja={pageX:a[0].pageX,pageY:a[0].pageY,timeStamp:Date.now()}),Z(a)},La=a=>{if(ja&&40<Math.hypot(a[0].pageX-ja.pageX,a[0].pageY-ja.pageY)&&(ja=null),null!==T){const[{pageX:t,pageY:r},{pageX:n,pageY:o}]=a;U=Math.min(Math.max(R/Math.sqrt((t-n)**2+(r-o)**2)*T,0),10),Q()}(([{pageX:a,pageY:t}])=>{null!==V&&(q-=(a-V)/window.innerHeight*4,k-=(t-W)/window.innerHeight*4,k=Math.min(Math.max(k,.14*Math.PI),.45*Math.PI),document.getElementsByTagName("div")[0].style.opacity=""+Math.min(Math.max(4*k-3.4,0),1),V=a,W=t,Q())})(a);const{pageX:t,pageY:r}=a[0];aa(va,ua,t/window.innerWidth*2-1,-(r/window.innerHeight*2-1)),p(Ma,va,ua,(0-va[1])/ua[1]),Ya=a;let n=0,o=0;for(const{pageX:t,pageY:r}of a)n+=t,o+=r;n/=a.length,o/=a.length,aa(ta,ra,n/window.innerWidth*2-1,-(o/window.innerHeight*2-1)),p(da,ta,ra,(1-ta[1])/ra[1])},Sa=a=>{V=T=null,Z(a),ja&&Date.now()<ja.timeStamp+300&&(0<fa?sa=1:(sa=0,ca=1,fa=.2,console.log("acc")),(()=>{if(!(ba+3>Date.now()/1e3)){ba=Date.now()/1e3;var[{pageX:a,pageY:t}]=Ya;aa(Ca,Da,a/window.innerWidth*2-1,-(t/window.innerHeight*2-1)),p(da,Ca,Da,(1-Ca[1])/Da[1]);var r=b();r[0]=-Da[0],r[1]=-Da[2],((a,t)=>{var r=t[0],n=t[1];0<(r=r*r+n*n)&&(r=1/Math.sqrt(r)),a[0]=t[0]*r,a[1]=t[1]*r})(r,r),Pa[0]=da[0],Pa[1]=da[2];var n=Math.max(...[(17-Pa[0])/r[0],(17-Pa[1])/r[1],(-17-Pa[1])/r[1],(-17-Pa[0])/r[0]].filter(a=>0>a));((a,t)=>{var r=Pa,n=Pa;r[0]=n[0]+a[0]*t,r[1]=n[1]+a[1]*t})(r,n),n=4+6*Math.random();var o=1.3+.5*Math.random(),e={n:r,t:.5,v:n,u:o,h:5,o:r[0]*Pa[0]+r[1]*Pa[1],l:-r[1]*Pa[0]+r[0]*Pa[1],i:1,force:s(),s:0,M:Infinity};e.force[1]=.2*Math.random()-1.2,Aa.push(e),(n={n:r,t:1.5,v:n+2,u:o,h:5,o:r[0]*Pa[0]+r[1]*Pa[1]-3.5,l:-r[1]*Pa[0]+r[0]*Pa[1],i:1,force:s(),s:0,M:Infinity}).force[0]=.2*r[0],n.force[1]=.8,n.force[2]=.2*r[1],Aa.push(n)}})())};a.addEventListener("mousedown",a=>Ia([a])),a.addEventListener("mousemove",a=>La([a])),a.addEventListener("mouseup",()=>Sa([])),a.addEventListener("touchstart",a=>Ia(Array.from(a.touches)),{passive:1}),a.addEventListener("touchmove",a=>La(Array.from(a.touches)),{passive:1}),a.addEventListener("touchend",a=>Sa(Array.from(a.touches)),{passive:1});let za=(a,t,r)=>(0>r&&(r+=1),1<r&&--r,r<1/6?a+6*(t-a)*r:.5>r?t:r<2/3?a+(t-a)*(2/3-r)*6:a),ka=t.createBuffer(),qa=t.createBuffer(),Ua=t.createBuffer(),Ba=new Float32Array(1e4);Ba.fill(1);let Ea=new Float32Array(4e4),Ga=Array.from({length:2500},(a,t)=>new Float32Array(Ea.buffer,64*t,16)),Ha=new Float32Array(4e4),Ja=Array.from({length:2500},(a,t)=>(v(a=new Float32Array(Ha.buffer,64*t,16)),a)),Ka=i();t.bindBuffer(t.ARRAY_BUFFER,ka),t.bufferData(t.ARRAY_BUFFER,Ea,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,qa),t.bufferData(t.ARRAY_BUFFER,Ha,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,Ua),t.bufferData(t.ARRAY_BUFFER,Ba,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null);let Na=s(),Oa=F(),Qa=[0,0,0],Ra=[0,0,0],Ta=[0,0,0],Va=[0,0,0],Wa=[0,0,0],Za=[0,0,0],$a=[0,0,0],at=a=>{const t=new Float32Array(a.length);for(let r=0;r<a.length/3;r+=3){const n=3*(r+0),o=3*(r+1),e=3*(r+2);m(Va,a[n+0],a[n+1],a[n+2]),m(Wa,a[o+0],a[o+1],a[o+2]),m(Za,a[e+0],a[e+1],a[e+2]),y(Ra,Va,Wa),y(Ta,Va,Za),_($a,Ra,Ta),g($a,$a),t[n+0]=t[o+0]=t[e+0]=$a[0],t[n+1]=t[o+1]=t[e+1]=$a[1],t[n+2]=t[o+2]=t[e+2]=$a[2]}return t},tt=t.createBuffer(),rt=t.createBuffer(),nt=t.createBuffer(),ot=[[0,0,1.5],[.6,0,.5],[-.6,0,.5],[-.6,0,.5],[.6,0,.5],[.4,0,-1.5],[-.6,0,.5],[.4,0,-1.5],[-.4,0,-1.5]],et=at(ot.flat()),it=Array.from({length:ot.length},(a,t)=>[et[3*t],et[3*t+1],et[3*t+2]]),lt=new Float32Array(Array.from({length:100},()=>[.2,.78,.85]).flat()),ht=M(),Mt=M(),vt=i(),ut=s(),ct=new Float32Array(3*ot.length),ft=new Float32Array(3*ot.length);t.bindBuffer(t.ARRAY_BUFFER,tt),t.bufferData(t.ARRAY_BUFFER,ct,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,rt),t.bufferData(t.ARRAY_BUFFER,ct,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,nt),t.bufferData(t.ARRAY_BUFFER,lt,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null);let st,wt=(a,r)=>{a=mt(a,t.VERTEX_SHADER),r=mt(r,t.FRAGMENT_SHADER);const n=t.createProgram();return t.attachShader(n,a),t.attachShader(n,r),t.linkProgram(n),n},mt=(a,r)=>(r=t.createShader(r),t.shaderSource(r,a),t.compileShader(r),r),yt=a=>{for(let r=0;4>r;++r){const n=a+r;t.enableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,0,64,16*r),t.vertexAttribDivisor(n,1)}},pt=async()=>{const a=await fetch("skull-vertices.bin").then(a=>a.arrayBuffer()),t=new Uint16Array(a);return new Float32Array(Array.from({length:t.length},(a,r)=>.95*(t[r]/65536-.5)))},gt=wt("#version 300 es\nin vec4 a_position;in vec4 a_normal;in vec4 a_color;in mat4 a_matrix;in mat4 a_normalMatrix;uniform mat4 u_matrix;uniform mat4 u_normalMatrix;out vec3 v_color;out vec3 v_normal;void main(){gl_Position=u_matrix*a_matrix*a_position;v_normal=vec3(u_normalMatrix*a_normalMatrix*a_normal);v_color=a_color.rgb;}","#version 300 es\nprecision highp float;in vec3 v_color;in vec3 v_normal;out vec4 outColor;void main(){vec3 staticLightDirection=vec3(0.615457,0.492365,0.615457);float staticLightPower=dot(v_normal,staticLightDirection);outColor=vec4(v_color,1.0);outColor.rgb*=0.6+clamp(staticLightPower,-0.47,10.0)*0.45;}"),At=t.getUniformLocation(gt,"u_matrix"),_t=t.getUniformLocation(gt,"u_normalMatrix"),dt=t.createVertexArray();t.bindVertexArray(dt);var Ft=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,Ft),t.bufferData(t.ARRAY_BUFFER,new Float32Array,t.STATIC_DRAW);let xt=t.getAttribLocation(gt,"a_position");t.enableVertexAttribArray(xt),t.vertexAttribPointer(xt,3,t.FLOAT,0,0,0);var Xt=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,Xt),t.bufferData(t.ARRAY_BUFFER,new Float32Array,t.STATIC_DRAW);let Yt=t.getAttribLocation(gt,"a_normal");t.enableVertexAttribArray(Yt),t.vertexAttribPointer(Yt,3,t.FLOAT,0,0,0),t.bindBuffer(t.ARRAY_BUFFER,Ua);let Ct=t.getAttribLocation(gt,"a_color");t.enableVertexAttribArray(Ct),t.vertexAttribPointer(Ct,4,t.FLOAT,0,0,0),t.vertexAttribDivisor(Ct,1),t.bindBuffer(t.ARRAY_BUFFER,ka),yt(t.getAttribLocation(gt,"a_matrix")),t.bindBuffer(t.ARRAY_BUFFER,qa),yt(t.getAttribLocation(gt,"a_normalMatrix")),t.bindVertexArray(null);let Dt=0;(async()=>{var a=await(st||(st=pt()));return{m:a=new Float32Array(a.buffer,0,1314),p:at(a)}})().then(({m:a,p:r})=>{t.bindBuffer(t.ARRAY_BUFFER,Ft),t.bufferData(t.ARRAY_BUFFER,a,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,Xt),t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),Dt=a.length/3});let Pt=wt("#version 300 es\nin vec4 a_position;in mat4 a_matrix;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*a_matrix*a_position;}","#version 300 es\nprecision highp float;out vec4 outColor;void main(){outColor=vec4(0.18,0.09,0.08,1);}"),bt=t.getUniformLocation(Pt,"u_matrix"),jt=t.createVertexArray();t.bindVertexArray(jt);var It=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,It),t.bufferData(t.ARRAY_BUFFER,new Float32Array,t.STATIC_DRAW);let Lt=t.getAttribLocation(Pt,"a_position");t.enableVertexAttribArray(Lt),t.vertexAttribPointer(Lt,3,t.FLOAT,0,0,0),t.bindBuffer(t.ARRAY_BUFFER,ka),yt(t.getAttribLocation(Pt,"a_matrix")),t.bindVertexArray(null);let St=0;(async()=>{var a=await(st||(st=pt())),t=(a=>Array.from({length:a.length/9},(t,r)=>[[a[9*r],a[9*r+1],a[9*r+2]],[a[9*r+3],a[9*r+4],a[9*r+5]],[a[9*r+6],a[9*r+7],a[9*r+8]]]))(a=new Float32Array(a.buffer,1656,1008));a=Float32Array,t=(a=>{const t=(a=>{const t=s(),r=s();for(var n of(m(t,9999,9999,9999),m(r,-9999,-9999,-9999),a))for(var o of n){var e=a=t,i=o;a[0]=Math.min(e[0],i[0]),a[1]=Math.min(e[1],i[1]),a[2]=Math.min(e[2],i[2]),e=a=r,i=o,a[0]=Math.max(e[0],i[0]),a[1]=Math.max(e[1],i[1]),a[2]=Math.max(e[2],i[2])}return o=t[1],a=t[2],t[0]=(n=t[0])+.5*(r[0]-n),t[1]=o+.5*(r[1]-o),t[2]=a+.5*(r[2]-a),t})(a);return a.map(a=>a.map(a=>{const r=s();return y(r,a,t),g(r,r),p(r,a,r,.1),r}).reverse())})(t).flat();var r=[];for(let a=0;a<t.length;a++)for(let n=0;n<t[a].length;n++)r.push(t[a][n]);return{m:new a(r)}})().then(({m:a})=>{t.bindBuffer(t.ARRAY_BUFFER,It),t.bufferData(t.ARRAY_BUFFER,a,t.DYNAMIC_DRAW),St=a.length/3});let zt=wt("#version 300 es\nin vec4 a_position;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*a_position;}","#version 300 es\nprecision highp float;out vec4 outColor;void main(){outColor=vec4(0.258,0.215,0.168,1);}"),kt=t.getUniformLocation(zt,"u_matrix"),qt=t.createVertexArray();t.bindVertexArray(qt),t.bindBuffer(t.ARRAY_BUFFER,I);let Ut=t.getAttribLocation(zt,"a_position");t.enableVertexAttribArray(Ut),t.vertexAttribPointer(Ut,3,t.FLOAT,0,0,0),t.bindVertexArray(null),t.clearColor(0,0,0,0),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS);let Bt=Math.floor(34/1.2)+2,Et=Array.from({length:Bt**2},()=>new Set),Gt=(a,t,r)=>{const n=Math.floor((t- -18)/1.2),o=Math.floor((r- -18)/1.2);a.pop(),a.pop(),a.pop(),a.pop(),0>n||n>=Bt||0>o||o>=Bt||(a.push(Et[n*Bt+o]),r=.6<1-(r-1.2*o)&&o+1<Bt,(t=.6<1-(t-1.2*n)&&n+1<Bt)&&a.push(Et[(n+1)*Bt+o]),r&&(a.push(Et[n*Bt+(o+1)]),t&&a.push(Et[(n+1)*Bt+(o+1)])))},Ht=[],Jt=[],Kt=F(),Nt=F(),Ot=F(),Qt=s(),Rt=s(),Tt=s(),Vt=x(F()),Wt=new Float32Array(4800),Zt=new Float32Array(6400);x(Kt);for(let a=1600;a--;)ia(Zt,a,Kt);for(let a=1600;a--;)x(Kt),X(Kt,Kt,.1*Math.random()),Y(Kt,Kt,.1*Math.random()),ia(Zt,a,Kt);let $t=new Float32Array(4800),ar=[{n:m(s(),0,0,1),d:0,g:m(s(),0,0,-17)},{n:m(s(),0,0,-1),d:0,g:m(s(),0,0,17)},{n:m(s(),-1,0,0),d:0,g:m(s(),17,0,0)},{n:m(s(),1,0,0),d:0,g:m(s(),-17,0,0)}];for(let a of ar)a.d=-A(a.n,a.g);let tr=[],rr=new Set,nr=(a,t,r)=>{$t[3*a]+=t[0]*r,$t[3*a+1]+=t[1]*r,$t[3*a+2]+=t[2]*r},or=0,er=[],ir=Math.floor(1156/.81),lr=1600;for(;0<lr;){let a=Math.min(lr,ir);er.push(Math.sqrt(1156/a)),lr-=a}for(let a=1600;a--;){D(Kt),ia(ha,a,Kt);let t=Math.floor(a/ir),r=er[t],n=Math.ceil(34/r),o=Math.floor(a%ir/n);la[3*a]=a%ir%n*r-17+.5,la[3*a+1]=t*r+.8*Math.random(),la[3*a+2]=o*r-17+.5,Gt(tr,la[3*a],la[3*a+2]);for(let t=tr.length;t--;)tr[t].add(a)}let hr=F(),Mr=0,vr=Math.ceil(34/1.05)**2,ur=[],cr=900;for(;0<cr;){let a=Math.min(cr,vr);ur.push(Math.sqrt(1156/a)),cr-=a}for(let a=1600;2500>a;a++){D(hr),ia(ha,a,hr);let t=a-1600,r=Math.floor(t/vr),n=ur[r],o=Math.ceil(34/n),e=t%vr%o,i=Math.floor(t%vr/o);la[3*a]=(e+.5)*n+.36+Math.random()*(n-.72)-17,la[3*a+2]=(i+(e%2?.5:0))*n+.36+Math.random()*(n-.72)-17,la[3*a+1]=-(2.2+1.5*r)+.6*Math.random()}for(let a=1600;2500>a;a++){let t=1600+Math.floor(900*Math.random()),r=la[3*a],n=la[3*a+1],o=la[3*a+2];la[3*a]=la[3*t],la[3*a+1]=la[3*t+1],la[3*a+2]=la[3*t+2],la[3*t]=r,la[3*t+1]=n,la[3*t+2]=o}let fr=1/60,sr=()=>{or=(or+1)%1024;var a=(or%37)**2+or%19*7;$t.fill(0);for(var r=0;1600>r;r++){na(Qt,r),$t[3*r]+=.018*-Wt[3*r]/fr,$t[3*r+1]+=.018*-Wt[3*r+1]/fr,$t[3*r+2]+=.018*-Wt[3*r+2]/fr,oa(Ot,Zt,r),C(Ot,Ot,Vt,.06),.7<Math.abs(Wt[3*r+1])&&r%47==a%47&&(X(Ot,Ot,.1*(Math.random()-.5)),Y(Ot,Ot,.1*(Math.random()-.5))),ia(Zt,r,Ot),$t[3*r+1]-=7,0>Qt[1]&&($t[3*r+1]+=30*-Qt[1]);for(var n=Aa.length;n--;){var o=Aa[n];nr(r,o.force,1/Math.max(.2,Math.abs(o.n[0]*Qt[0]+o.n[1]*Qt[2]-o.o))/Math.max(Math.abs(-o.n[1]*Qt[0]+o.n[0]*Qt[2]-o.l)-o.t,.2))}for(n=ar.length;n--;){var e=A(Qt,(o=ar[n]).n)+o.d-.5;0>e&&nr(r,o.n,20*(Math.min(-e,.16)/.16)**2)}for(rr.clear(),Gt(tr,Qt[0],Qt[2]),n=tr.length;n--;)for(var i of tr[n])if(i<r&&!rr.has(i)){na(Rt,i),rr.add(i),y(Tt,Qt,Rt);var M=Tt;if(1>(o=(o=M[0])*o+(e=M[1])*e+(M=M[2])*M)){var v=Math.sqrt(o);1e-4<v?(M=e=Tt,e[0]=M[0]*(o=1/v),e[1]=M[1]*o,e[2]=M[2]*o):m(Tt,0,1,0),o=60*Math.min(.25,1/(1-v/1)),nr(r,Tt,o),nr(i,Tt,-o),Qt[1]>Rt[1]?$t[3*r+1]+=.7*o:$t[3*i+1]+=.7*o}}}for(a=1600;a--;){r=la[3*a],i=la[3*a+2],Wt[3*a]+=fr*$t[3*a],Wt[3*a+1]+=fr*$t[3*a+1],Wt[3*a+2]+=fr*$t[3*a+2],la[3*a]+=fr*Wt[3*a],la[3*a+1]+=fr*Wt[3*a+1],la[3*a+2]+=fr*Wt[3*a+2],oa(Nt,ha,a),oa(Ot,Zt,a);var f=n=Nt;e=f[1],M=f[2];var s=(v=Ot)[0],w=v[1],_=v[2];if(n[0]=(o=f[0])*(v=v[3])+(f=f[3])*s+e*_-M*w,n[1]=e*v+f*w+M*s-o*_,n[2]=M*v+f*_+o*w-e*s,n[3]=f*v-o*s-e*w-M*_,ia(ha,a,Nt),n=a,o=la[3*a],e=la[3*a+2],Gt(Ht,r,i),Gt(Jt,o,e),Ht[0]!==Jt[0]||Ht[1]!==Jt[1]||Ht[2]!==Jt[2]){for(r=Ht.length;r--;)Ht[r].delete(n);for(r=Jt.length;r--;)Jt[r].add(n)}}for(y(ua,Ma,ya),ua[1]=0,g(ua,ua),x(pa),P(pa,ga,ua),ma.fill(0),p(ma,ma,wa,-7.2),fa=Math.max(0,fa-fr),0===fa&&sa&&(sa=0,ca=1,fa=.2,console.log("acc")),p(ma,ma,ua,100*ca),ca*=.85,p(wa,wa,ma,fr),p(ya,ya,wa,fr),ya[1]=(()=>{var a=ya[0],t=ya[2];const r=[];for(let n=0;1600>n;n++)4>(la[3*n]-a)**2+(la[3*n+2]-t)**2&&r.push(n);return 0===r.length?1.5:r.map(a=>la[3*a+1]).sort().slice(-2).reduce((a,t,r,{length:n})=>a+t/n,0)+.5})(),a=Mr,Mr+=fr,r=1600;2500>r;r++)i=733*r%17/17*Math.PI*2,n=2.8*(1-(n=619*r%13/13))+3.8*n,o=.1*(1-(o=157*r%7/7))+.2*o,la[3*r+1]+=Math.sin(n*Mr+i)*o-Math.sin(n*a+i)*o;for(a=Aa.length;a--;)(r=Aa[a]).o+=r.h*fr,r.u&&(r.t=Math.min(r.t+r.u*fr,r.v??Infinity)),r!==Xa&&25.5<Math.abs(r.o)&&Aa.splice(a,1);for(var F of xa)F.o>17*1.15&&(F.o-=1.15*34);for(t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),F=2500;F--;){na(Na,F),oa(Oa,ha,F),a=1.088+F%37/37*.05,n=.25+79*F%23/23*.1,i=.4+.55*Math.min(Math.max((la[3*F+1]- -1)/3.2,0),1),(r=Qa)[0]=za(i=2*i-(n=.5>i?i*(1+n):i+n-i*n),n,a+1/3),r[1]=za(i,n,a),r[2]=za(i,n,a-1/3),c(Ga[F],Oa,Na),l(Ka,Ga[F]),i=(s=a=Ka)[1],n=s[2],M=s[5];var D=(f=s[7])*(o=s[3])-(e=s[4])*(v=s[6]),b=(r=s[0])*(w=(s=s[8])*e-M*f)+i*(_=-s*o+M*v)+n*D;b&&(a[0]=w*(b=1/b),a[1]=(-s*i+n*f)*b,a[2]=(M*i-n*e)*b,a[3]=_*b,a[4]=(s*r-n*v)*b,a[5]=(-M*r+n*o)*b,a[6]=D*b,a[7]=(-f*r+i*v)*b,a[8]=(e*r-i*o)*b),r=a=Ka,a===r?(i=r[1],n=r[2],o=r[5],a[1]=r[3],a[2]=r[6],a[3]=i,a[5]=r[7],a[6]=n,a[7]=o):(a[0]=r[0],a[1]=r[3],a[2]=r[6],a[3]=r[1],a[4]=r[4],a[5]=r[7],a[6]=r[2],a[7]=r[5],a[8]=r[8]),(a=Ja[F])[0]=(r=Ka)[0],a[1]=r[1],a[2]=r[2],a[4]=r[3],a[5]=r[4],a[6]=r[5],a[8]=r[6],a[9]=r[7],a[10]=r[8],Ba[4*F]=Qa[0],Ba[4*F+1]=Qa[1],Ba[4*F+2]=Qa[2]}for(t.bindBuffer(t.ARRAY_BUFFER,ka),t.bufferSubData(t.ARRAY_BUFFER,0,Ea),t.bindBuffer(t.ARRAY_BUFFER,qa),t.bufferSubData(t.ARRAY_BUFFER,0,Ha),t.bindBuffer(t.ARRAY_BUFFER,Ua),t.bufferSubData(t.ARRAY_BUFFER,0,Ba),c(ht,pa,ya),u(ht,H,ht),u(Mt,L,ht),h(vt,ht),n=0;n<ot.length;n++)d(ut,ot[n],Mt),ea(ct,n),(F=ut)[0]=(r=(o=it[n])[0])*(a=vt)[0]+(i=o[1])*a[3]+(o=o[2])*a[6],F[1]=r*a[1]+i*a[4]+o*a[7],F[2]=r*a[2]+i*a[5]+o*a[8],ea(ft,n);t.bindBuffer(t.ARRAY_BUFFER,tt),t.bufferSubData(t.ARRAY_BUFFER,0,ct),t.bindBuffer(t.ARRAY_BUFFER,rt),t.bufferSubData(t.ARRAY_BUFFER,0,ft),t.useProgram(zt),t.uniformMatrix4fv(kt,0,K),t.bindVertexArray(qt),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.drawArrays(t.TRIANGLES,0,12),t.bindVertexArray(null),t.useProgram(gt),t.uniformMatrix4fv(At,0,K),t.uniformMatrix4fv(_t,0,O),t.bindVertexArray(dt),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.drawArraysInstanced(t.TRIANGLES,0,Dt,2500),t.bindVertexArray(null),t.useProgram(Pt),t.uniformMatrix4fv(bt,0,K),t.bindVertexArray(jt),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.drawArraysInstanced(t.TRIANGLES,0,St,2500),t.bindVertexArray(null),requestAnimationFrame(sr)};sr();</script></html>